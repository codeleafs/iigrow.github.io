---
layout:page
title:"<<高性能网站建设指南>>读书笔记"
date:  
categories: Performance
---

* ##规则1 减少HTTP请求

用户响应时间大部分都花在了请求HTML文档所引用的组件上，因此缩短响应时间最简单的方式就是减少组件的数量，以此来减少HTTP请求的数量。

>CSS Sprites

将多个图片合并到一个单独的图片中。然后通过backgroud-image指定图片地址，调整backgroud-position属性值，显示对应图片。

>Inline Images

通过data:[<mediatpe>][;base64],<data>的形式将小块数据内联为 immediate 数，但是在跨越不同页面时不会被缓存，除非将该内联数据放在CSS单独文件中，通过缓存CSS文件从而缓存该数据。

>Combined Scripts and Stylesheets

将多个Javascript文件或者CSS文件合并为一个文件，可有效减少请求，但要注意可合并为一个的多个文件缓存时长及更新频率应该相近，而且要尽可能的按照功能模块去合并。

* ##规则2 使用CDN(Content Delivery Network)

如果网络资源离用户更近，则一个HTTP请求的响应时间将缩短，通过CDN服务将会缩短请求响应时间。
CDN是一组分布在多个不同地理位置上的Web服务器，用于更加有效地向用户发布内容（静态内容 包括图片，脚本，样式表等）。
CDN除了可以缩短响应时间，而且还有助于缓和Web流量峰值形成的负载压力。

* ##规则3 添加Expires头

Web客户端可通过使用缓存来减少HTTP请求的数量，并减小HTTP响应的大小。在服务器端给可缓存资源添加Expires头，则Web客户端会使用该资源，直到指定的时间为止。但是使用Expires头需要一个特定的时间，要求服务器和客户端时钟严格同步，使用起来较麻烦。

HTTP1.1引入了Cache-Control头来克服Expires头的限制，Cache-Control使用max-age指令指定组件被缓存多久。

将版本号嵌入在组件的文件名中(ontree_1.0.1.js)，可以确保在缓存时间到期之前资源的更新。

* ##规则4 压缩组件

从HTTP1.1开始，Web客户端可以通过HTTP请求中的Accept-Encoding头来表示对压缩的支持，当服务器监测到该头，就会使用客户端列出来的方法中的一种来压缩响应，然后通过响应头中的Content-Encoding头来通知Web客户端。gzip是目前最流行和最有效的压缩方法。压缩通常能将响应的数据量减少近70%，压缩内容可包括 HTML文档\脚本\样式表\及其他响应文本。

在Web服务器的响应中添加Vary头（Vary:Accept-Encoding），则可以通知代理根据一个或多个请求头来改变缓存的响应，使得代理缓存多个版本，以避免相同URL而Accept-Encoding头不同时，而引起的无压缩(将缓存的非gzip数响应给gzip客户端)或缓存冲突(将gzip数据响应给不支持gzip的客户端)。

* ##规则5 将样式表放置顶部

将样式表放在文档底部时，浏览器为了避免当样式变化时重绘页面中的元素，所以会阻塞内容逐步呈现，延迟显示任何可视化组件，产生白屏的现象。为了避免产生白屏，将样式表放在文档顶部的Head中，内容会逐步呈现。

FOUC(Flash of Unstyled Content):无样式内容的闪烁，将样式表放入底部时，浏览器逐步呈现无样式的内容，加载完样式表后，重绘相关元素，造成无样式到有样式的闪烁。

* ##规则6 将脚本放在底部

HTTP1.1规范建议浏览器从每个主机名并行地下载两个组件。然而在下载脚本时并行下载实际上是被禁用的，即使使用了不同的主机名。有以下两个原因: 

1. 脚本可能使用document.write来修改页面内容，因此浏览器会等待，以确保页面能够恰当地布局；
2. 浏览器要保证脚本能够按照正确的顺序执行，如果并行下载多个脚本，无法保证响应是按照指定顺序到达浏览器的。

因此脚本不仅会阻塞对其后面内容的呈现，而且会阻塞对其后面组件的下载。如果将脚本放置页面顶端，则整个页面的呈现和加载都会被阻塞，体验非常糟糕。可以通过以下几种方式解决该问题:

1. 将脚本放置页面的底部，使页面可视化组件尽早下载；
2. 使用延迟脚本，通过指定Script标签的defer属性来延迟脚本的执行，直到页面加载为止。


* ##规则7 避免CSS表达式

CSS表达式的问题在于对其进行求值的频率比人们期望的要高，它们不仅在页面呈现和大小改变时求值，当页面滚动甚至用户鼠标在页面上拖拽时都要求值。

* ##规则8 使用外部Javascript和CSS

外部JavaScript和CSS文件有机会被浏览器缓存起来。如果你的网站中每个页面都使用了相同的JavaSctipt和CSS，使用外部文件可以提高这些组件的重用率。

* ##规则9 减少DNS查找

DNS(Domain Name System)将主机名映射到IP地址上，在用户请求了一个主机名之后，DNS信息会留在操作系统的DNS缓存中，之后在短时间内不需要再次查询DNS。

* ##规则10 精简Javascript

* ##规则11 避免重定向

* ##规则12 删除重复脚本

* ##规则13 配置ETag

* ##规则14 使Ajax可缓存